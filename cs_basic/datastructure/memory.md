---
title: c_memory
date: 2022-01-03 23:20:06
tags:
    - Linux
    - C
    - Memory
    - Notes
---

## 内存分区
* 栈区（stack）:
  
  栈又称堆栈，是用户存放程序临时创建的局部变量,
  存放函数形参和局部变量（auto类型），由编译器自动分配和释放。

  在函数被调用时，其参数也会被压入发起调用的进程栈中，并且待到调用结束后，函数的返回值也会被存放回栈中。

  由于栈的先进先出(FIFO)特点，所以栈特别方便用来保存/恢复调用现场。


* 堆区（heap）:
  
  堆是用于存放进程运行中被动态分配的内存段，它的大小并不固定，可动态扩张或缩减。
  该区由程序员申请后使用，需要手动释放否则会造成内存泄漏。
  如果程序员没有手动释放，那么程序结束时可能由OS回收。

* 全局/静态存储区：
  
  存放全局变量和静态变量（包括静态全局变量与静态局部变量），初始化的全局变量和静态局部变量放在一块，未初始化的放在另一块。

* 文字常量区：
  
  常量在统一运行被创建，常量区的内存是只读的，程序结束后由系统释放。

* 程序代码区：
  
  存放程序的二进制代码，内存由系统管理

## 可执行分段
一个程序本质上都是由 bss段、data段、text段三个组成的。

- `text`
  
  这部分区域的大小在程序运行前就已经确定，并且内存区域通常属于只读(某些架构也允许代码段为可写，即允许修改程序)。
  在代码段中，也有可能包含一些只读的常数变量，例如字符串常量等

- `date`

  存放在编译阶段（而非运行时）就能确定的数据，可读可写, 是指用来存放程序中已初始化的全局变量的一块内存区域。
  也就是通常所说的静态存储区，赋了初值的全局变量和赋初值的静态变量存放在这个区域，常量也存在这个区域.
  数据段属于静态内存分配.

- `bss`
  bss段（bss segment）通常是指用来存放程序中未初始化的全局变量的一块内存区域。
  bss是英文Block Started by Symbol的简称。
  bss段属于静态内存分配。
  已经定义但没赋初值的全局变量和静态变量存放在这个区域。

> `text` 段在内存中被映射为只读，但 `date` 段与 `bss` 段是可写的.


![m](../imgs/memory.gif)


> 代码段，数据段，堆栈段是cpu级别的概念，五大分区属于语言级别的概念
